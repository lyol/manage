(function(o){"use strict";if(window.layui&&layui.define){layui.define(["jquery","ztree"],function(e){var t=layui.$,r=layui.ztree;e("ztreeExedit",o(t))})}else{o(jQuery)}})(function(Te){if(!window.larrymsExtend){return false}var Ee={event:{DRAG:"ztree_drag",DROP:"ztree_drop",RENAME:"ztree_rename",DRAGMOVE:"ztree_dragmove"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},e={edit:{enable:false,editNameSelectAll:false,showRemoveBtn:true,showRenameBtn:true,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:false,isCopy:true,isMove:true,prev:true,next:true,inner:true,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDragMove:null,onDrop:null,onRename:null}},t=function(e){var t=Re.getRoot(e),r=Re.getRoots();t.curEditNode=null;t.curEditInput=null;t.curHoverNode=null;t.dragFlag=0;t.dragNodeShowBefore=[];t.dragMaskList=new Array;r.showHoverDom=true},r=function(e){},o=function(a){var e=a.treeObj;var t=he.event;e.bind(t.RENAME,function(e,t,r,o){Ie.apply(a.callback.onRename,[e,t,r,o])});e.bind(t.DRAG,function(e,t,r,o){Ie.apply(a.callback.onDrag,[t,r,o])});e.bind(t.DRAGMOVE,function(e,t,r,o){Ie.apply(a.callback.onDragMove,[t,r,o])});e.bind(t.DROP,function(e,t,r,o,d,i,n){Ie.apply(a.callback.onDrop,[t,r,o,d,i,n])})},d=function(e){var t=e.treeObj;var r=he.event;t.unbind(r.RENAME);t.unbind(r.DRAG);t.unbind(r.DRAGMOVE);t.unbind(r.DROP)},i=function(e){var t=e.target,r=Re.getSetting(e.data.treeId),o=e.relatedTarget,d="",i=null,n="",a="",l=null,s=null,f=null;if(Ie.eqs(e.type,"mouseover")){f=Ie.getMDom(r,t,[{tagName:"a",attrName:"treeNode"+he.id.A}]);if(f){d=Ie.getNodeMainDom(f).id;n="hoverOverNode"}}else if(Ie.eqs(e.type,"mouseout")){f=Ie.getMDom(r,o,[{tagName:"a",attrName:"treeNode"+he.id.A}]);if(!f){d="remove";n="hoverOutNode"}}else if(Ie.eqs(e.type,"mousedown")){f=Ie.getMDom(r,t,[{tagName:"a",attrName:"treeNode"+he.id.A}]);if(f){d=Ie.getNodeMainDom(f).id;n="mousedownNode"}}if(d.length>0){i=Re.getNodeCache(r,d);switch(n){case"mousedownNode":l=c.onMousedownNode;break;case"hoverOverNode":l=c.onHoverOverNode;break;case"hoverOutNode":l=c.onHoverOutNode;break}}var u={stop:false,node:i,nodeEventType:n,nodeEventCallback:l,treeEventType:a,treeEventCallback:s};return u},n=function(e,t,r,o,d,i,n){if(!r)return;r.isHover=false;r.editNameFlag=false},a=function(l,e){e.cancelEditName=function(e){var t=Re.getRoot(this.setting);if(!t.curEditNode)return;be.cancelCurEditNode(this.setting,e?e:null,true)};e.copyNode=function(e,t,r,o){if(!t)return null;var d=Re.nodeIsParent(l,e);if(e&&!d&&this.setting.data.keep.leaf&&r===he.move.TYPE_INNER)return null;var i=this,n=Ie.clone(t);if(!e){e=null;r=he.move.TYPE_INNER}if(r==he.move.TYPE_INNER){function a(){be.addNodes(i.setting,e,-1,[n],o)}if(Ie.canAsync(this.setting,e)){be.asyncNode(this.setting,e,o,a)}else{a()}}else{be.addNodes(this.setting,e.parentNode,-1,[n],o);be.moveNode(this.setting,e,n,r,false,o)}return n};e.editName=function(e){if(!e||!e.tId||e!==Re.getNodeCache(this.setting,e.tId))return;if(e.parentTId)be.expandCollapseParentNode(this.setting,e.getParentNode(),true);be.editNode(this.setting,e)};e.moveNode=function(e,t,r,o){if(!t)return t;var d=Re.nodeIsParent(l,e);if(e&&!d&&this.setting.data.keep.leaf&&r===he.move.TYPE_INNER){return null}else if(e&&(t.parentTId==e.tId&&r==he.move.TYPE_INNER||Pe(t,this.setting).find("#"+e.tId).length>0)){return null}else if(!e){e=null}var i=this;function n(){be.moveNode(i.setting,e,t,r,false,o)}if(Ie.canAsync(this.setting,e)&&r===he.move.TYPE_INNER){be.asyncNode(this.setting,e,o,n)}else{n()}return t};e.setEditable=function(e){this.setting.edit.enable=e;return this.refresh()}},l={setSonNodeLevel:function(e,t,r){if(!r)return;var o=Re.nodeChildren(e,r);r.level=t?t.level+1:0;if(!o)return;for(var d=0,i=o.length;d<i;d++){if(o[d])Re.setSonNodeLevel(e,r,o[d])}}},s={},c={onHoverOverNode:function(e,t){var r=Re.getSetting(e.data.treeId),o=Re.getRoot(r);if(o.curHoverNode!=t){c.onHoverOutNode(e)}o.curHoverNode=t;be.addHoverDom(r,t)},onHoverOutNode:function(e,t){var r=Re.getSetting(e.data.treeId),o=Re.getRoot(r);if(o.curHoverNode&&!Re.isSelectedNode(r,o.curHoverNode)){be.removeTreeDom(r,o.curHoverNode);o.curHoverNode=null}},onMousedownNode:function(e,t){var r,o,Q=Re.getSetting(e.data.treeId),Z=Re.getRoot(Q),J=Re.getRoots();if(e.button==2||!Q.edit.enable||!Q.edit.drag.isCopy&&!Q.edit.drag.isMove)return true;var d=e.target,i=Re.getRoot(Q).curSelectedList,ee=[];if(!Re.isSelectedNode(Q,t)){ee=[t]}else{for(r=0,o=i.length;r<o;r++){if(i[r].editNameFlag&&Ie.eqs(d.tagName,"input")&&d.getAttribute("treeNode"+he.id.INPUT)!==null){return true}ee.push(i[r]);if(ee[0].parentTId!==i[r].parentTId){ee=[t];break}}}be.editNodeBlur=true;be.cancelCurEditNode(Q);var te=Te(Q.treeObj.get(0).ownerDocument),re=Te(Q.treeObj.get(0).ownerDocument.body),oe,de,ie,ne=false,ae=Q,l=Q,le,se,fe=null,ue=null,ce=null,Ne=he.move.TYPE_INNER,ve=e.clientX,ge=e.clientY,me=(new Date).getTime();if(Ie.uCanDo(Q)){te.bind("mousemove",s)}function s(e){if(Z.dragFlag==0&&Math.abs(ve-e.clientX)<Q.edit.drag.minMoveSize&&Math.abs(ge-e.clientY)<Q.edit.drag.minMoveSize){return true}var t,r,o,d,i;re.css("cursor","pointer");if(Z.dragFlag==0){if(Ie.apply(Q.callback.beforeDrag,[Q.treeId,ee],true)==false){pe(e);return true}for(t=0,r=ee.length;t<r;t++){if(t==0){Z.dragNodeShowBefore=[]}o=ee[t];if(Re.nodeIsParent(Q,o)&&o.open){be.expandCollapseNode(Q,o,!o.open);Z.dragNodeShowBefore[o.tId]=true}else{Z.dragNodeShowBefore[o.tId]=false}}Z.dragFlag=1;J.showHoverDom=false;Ie.showIfameMask(Q,true);var n=true,a=-1;if(ee.length>1){var l=ee[0].parentTId?Re.nodeChildren(Q,ee[0].getParentNode()):Re.getNodes(Q);i=[];for(t=0,r=l.length;t<r;t++){if(Z.dragNodeShowBefore[l[t].tId]!==undefined){if(n&&a>-1&&a+1!==t){n=false}i.push(l[t]);a=t}if(ee.length===i.length){ee=i;break}}}if(n){le=ee[0].getPreNode();se=ee[ee.length-1].getNextNode()}oe=Pe("<ul class='zTreeDragUL'></ul>",Q);for(t=0,r=ee.length;t<r;t++){o=ee[t];o.editNameFlag=false;be.selectNode(Q,o,t>0);be.removeTreeDom(Q,o);if(t>Q.edit.drag.maxShowNodeNum-1){continue}d=Pe("<li id='"+o.tId+"_tmp'></li>",Q);d.append(Pe(o,he.id.A,Q).clone());d.css("padding","0");d.children("#"+o.tId+he.id.A).removeClass(he.node.CURSELECTED);oe.append(d);if(t==Q.edit.drag.maxShowNodeNum-1){d=Pe("<li id='"+o.tId+"_moretmp'><a>  ...  </a></li>",Q);oe.append(d)}}oe.attr("id",ee[0].tId+he.id.UL+"_tmp");oe.addClass(Q.treeObj.attr("class"));oe.appendTo(re);de=Pe("<span class='tmpzTreeMove_arrow'></span>",Q);de.attr("id","zTreeMove_arrow_tmp");de.appendTo(re);Q.treeObj.trigger(he.event.DRAG,[e,Q.treeId,ee])}if(Z.dragFlag==1){if(ie&&de.attr("id")==e.target.id&&ce&&e.clientX+te.scrollLeft()+2>Te("#"+ce+he.id.A,ie).offset().left){var s=Te("#"+ce+he.id.A,ie);e.target=s.length>0?s.get(0):e.target}else if(ie){ie.removeClass(he.node.TMPTARGET_TREE);if(ce)Te("#"+ce+he.id.A,ie).removeClass(he.node.TMPTARGET_NODE+"_"+he.move.TYPE_PREV).removeClass(he.node.TMPTARGET_NODE+"_"+Ee.move.TYPE_NEXT).removeClass(he.node.TMPTARGET_NODE+"_"+Ee.move.TYPE_INNER)}ie=null;ce=null;ne=false;ae=Q;var f=Re.getSettings();for(var u in f){if(f[u].treeId&&f[u].edit.enable&&f[u].treeId!=Q.treeId&&(e.target.id==f[u].treeId||Te(e.target).parents("#"+f[u].treeId).length>0)){ne=true;ae=f[u]}}var c=te.scrollTop(),N=te.scrollLeft(),v=ae.treeObj.offset(),g=ae.treeObj.get(0).scrollHeight,m=ae.treeObj.get(0).scrollWidth,p=e.clientY+c-v.top,T=ae.treeObj.height()+v.top-e.clientY-c,E=e.clientX+N-v.left,I=ae.treeObj.width()+v.left-e.clientX-N,h=p<Q.edit.drag.borderMax&&p>Q.edit.drag.borderMin,b=T<Q.edit.drag.borderMax&&T>Q.edit.drag.borderMin,R=E<Q.edit.drag.borderMax&&E>Q.edit.drag.borderMin,P=I<Q.edit.drag.borderMax&&I>Q.edit.drag.borderMin,w=p>Q.edit.drag.borderMin&&T>Q.edit.drag.borderMin&&E>Q.edit.drag.borderMin&&I>Q.edit.drag.borderMin,C=h&&ae.treeObj.scrollTop()<=0,M=b&&ae.treeObj.scrollTop()+ae.treeObj.height()+10>=g,_=R&&ae.treeObj.scrollLeft()<=0,O=P&&ae.treeObj.scrollLeft()+ae.treeObj.width()+10>=m;if(e.target&&Ie.isChildOrSelf(e.target,ae.treeId)){var D=e.target;while(D&&D.tagName&&!Ie.eqs(D.tagName,"li")&&D.id!=ae.treeId){D=D.parentNode}var y=true;for(t=0,r=ee.length;t<r;t++){o=ee[t];if(D.id===o.tId){y=false;break}else if(Pe(o,Q).find("#"+D.id).length>0){y=false;break}}if(y&&e.target&&Ie.isChildOrSelf(e.target,D.id+he.id.A)){ie=Te(D);ce=D.id}}o=ee[0];if(w&&Ie.isChildOrSelf(e.target,ae.treeId)){if(!ie&&(e.target.id==ae.treeId||C||M||_||O)&&(ne||!ne&&o.parentTId)){ie=ae.treeObj}if(h){ae.treeObj.scrollTop(ae.treeObj.scrollTop()-10)}else if(b){ae.treeObj.scrollTop(ae.treeObj.scrollTop()+10)}if(R){ae.treeObj.scrollLeft(ae.treeObj.scrollLeft()-10)}else if(P){ae.treeObj.scrollLeft(ae.treeObj.scrollLeft()+10)}if(ie&&ie!=ae.treeObj&&ie.offset().left<ae.treeObj.offset().left){ae.treeObj.scrollLeft(ae.treeObj.scrollLeft()+ie.offset().left-ae.treeObj.offset().left)}}oe.css({top:e.clientY+c+3+"px",left:e.clientX+N+3+"px"});var k=0;var S=0;if(ie&&ie.attr("id")!=ae.treeId){var A=ce==null?null:Re.getNodeCache(ae,ce),L=(e.ctrlKey||e.metaKey)&&Q.edit.drag.isMove&&Q.edit.drag.isCopy||!Q.edit.drag.isMove&&Q.edit.drag.isCopy,Y=!!(le&&ce===le.tId),x=!!(se&&ce===se.tId),j=o.parentTId&&o.parentTId==ce,z=(L||!x)&&Ie.apply(ae.edit.drag.prev,[ae.treeId,ee,A],!!ae.edit.drag.prev),B=(L||!Y)&&Ie.apply(ae.edit.drag.next,[ae.treeId,ee,A],!!ae.edit.drag.next),H=(L||!j)&&!(ae.data.keep.leaf&&!Re.nodeIsParent(Q,A))&&Ie.apply(ae.edit.drag.inner,[ae.treeId,ee,A],!!ae.edit.drag.inner);function F(){ie=null;ce="";Ne=he.move.TYPE_INNER;de.css({display:"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}if(!z&&!B&&!H){F()}else{var V=Te("#"+ce+he.id.A,ie),U=A.isLastNode?null:Te("#"+A.getNextNode().tId+he.id.A,ie.next()),G=V.offset().top,X=V.offset().left,q=z?H?.25:B?.5:1:-1,W=B?H?.75:z?.5:0:-1,K=(e.clientY+c-G)/V.height();if((q==1||K<=q&&K>=-.2)&&z){k=1-de.width();S=G-de.height()/2;Ne=he.move.TYPE_PREV}else if((W==0||K>=W&&K<=1.2)&&B){k=1-de.width();S=U==null||Re.nodeIsParent(Q,A)&&A.open?G+V.height()-de.height()/2:U.offset().top-de.height()/2;Ne=he.move.TYPE_NEXT}else if(H){k=5-de.width();S=G;Ne=he.move.TYPE_INNER}else{F()}if(ie){de.css({display:"block",top:S+"px",left:X+k+"px"});V.addClass(he.node.TMPTARGET_NODE+"_"+Ne);if(fe!=ce||ue!=Ne){me=(new Date).getTime()}if(A&&Re.nodeIsParent(Q,A)&&Ne==he.move.TYPE_INNER){var $=true;if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==A.tId){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}else if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===A.tId){$=false}if($){window.zTreeMoveTimer=setTimeout(function(){if(Ne!=he.move.TYPE_INNER)return;if(A&&Re.nodeIsParent(Q,A)&&!A.open&&(new Date).getTime()-me>ae.edit.drag.autoOpenTime&&Ie.apply(ae.callback.beforeDragOpen,[ae.treeId,A],true)){be.switchNode(ae,A);if(ae.edit.drag.autoExpandTrigger){ae.treeObj.trigger(he.event.EXPAND,[ae.treeId,A])}}},ae.edit.drag.autoOpenTime+50);window.zTreeMoveTargetNodeTId=A.tId}}}}}else{Ne=he.move.TYPE_INNER;if(ie&&Ie.apply(ae.edit.drag.inner,[ae.treeId,ee,null],!!ae.edit.drag.inner)){ie.addClass(he.node.TMPTARGET_TREE)}else{ie=null}de.css({display:"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}fe=ce;ue=Ne;Q.treeObj.trigger(he.event.DRAGMOVE,[e,Q.treeId,ee])}return false}te.bind("mouseup",pe);function pe(o){if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}fe=null;ue=null;te.unbind("mousemove",s);te.unbind("mouseup",pe);te.unbind("selectstart",f);re.css("cursor","");if(ie){ie.removeClass(he.node.TMPTARGET_TREE);if(ce)Te("#"+ce+he.id.A,ie).removeClass(he.node.TMPTARGET_NODE+"_"+he.move.TYPE_PREV).removeClass(he.node.TMPTARGET_NODE+"_"+Ee.move.TYPE_NEXT).removeClass(he.node.TMPTARGET_NODE+"_"+Ee.move.TYPE_INNER)}Ie.showIfameMask(Q,false);J.showHoverDom=true;if(Z.dragFlag==0)return;Z.dragFlag=0;var e,t,r;for(e=0,t=ee.length;e<t;e++){r=ee[e];if(Re.nodeIsParent(Q,r)&&Z.dragNodeShowBefore[r.tId]&&!r.open){be.expandCollapseNode(Q,r,!r.open);delete Z.dragNodeShowBefore[r.tId]}}if(oe)oe.remove();if(de)de.remove();var d=(o.ctrlKey||o.metaKey)&&Q.edit.drag.isMove&&Q.edit.drag.isCopy||!Q.edit.drag.isMove&&Q.edit.drag.isCopy;if(!d&&ie&&ce&&ee[0].parentTId&&ce==ee[0].parentTId&&Ne==he.move.TYPE_INNER){ie=null}if(ie){var i=ce==null?null:Re.getNodeCache(ae,ce);if(Ie.apply(Q.callback.beforeDrop,[ae.treeId,ee,i,Ne,d],true)==false){be.selectNodes(l,ee);return}var n=d?Ie.clone(ee):ee;function a(){if(ne){if(!d){for(var e=0,t=ee.length;e<t;e++){be.removeNode(Q,ee[e])}}if(Ne==he.move.TYPE_INNER){be.addNodes(ae,i,-1,n)}else{be.addNodes(ae,i.getParentNode(),Ne==he.move.TYPE_PREV?i.getIndex():i.getIndex()+1,n)}}else{if(d&&Ne==he.move.TYPE_INNER){be.addNodes(ae,i,-1,n)}else if(d){be.addNodes(ae,i.getParentNode(),Ne==he.move.TYPE_PREV?i.getIndex():i.getIndex()+1,n)}else{if(Ne!=he.move.TYPE_NEXT){for(e=0,t=n.length;e<t;e++){be.moveNode(ae,i,n[e],Ne,false)}}else{for(e=-1,t=n.length-1;e<t;t--){be.moveNode(ae,i,n[t],Ne,false)}}}}be.selectNodes(ae,n);var r=Pe(n[0],Q).get(0);be.scrollIntoView(Q,r);Q.treeObj.trigger(he.event.DROP,[o,ae.treeId,n,i,Ne,d])}if(Ne==he.move.TYPE_INNER&&Ie.canAsync(ae,i)){be.asyncNode(ae,i,false,a)}else{a()}}else{be.selectNodes(l,ee);Q.treeObj.trigger(he.event.DROP,[o,Q.treeId,ee,null,null,null])}}te.bind("selectstart",f);function f(){return false}return true}},f={getAbs:function(e){var t=e.getBoundingClientRect(),r=document.body.scrollTop+document.documentElement.scrollTop,o=document.body.scrollLeft+document.documentElement.scrollLeft;return[t.left+o,t.top+r]},inputFocus:function(e){if(e.get(0)){e.focus();Ie.setCursorPosition(e.get(0),e.val().length)}},inputSelect:function(e){if(e.get(0)){e.focus();e.select()}},setCursorPosition:function(e,t){if(e.setSelectionRange){e.focus();e.setSelectionRange(t,t)}else if(e.createTextRange){var r=e.createTextRange();r.collapse(true);r.moveEnd("character",t);r.moveStart("character",t);r.select()}},showIfameMask:function(e,t){var r=Re.getRoot(e);while(r.dragMaskList.length>0){r.dragMaskList[0].remove();r.dragMaskList.shift()}if(t){var o=Pe("iframe",e);for(var d=0,i=o.length;d<i;d++){var n=o.get(d),a=Ie.getAbs(n),l=Pe("<div id='zTreeMask_"+d+"' class='zTreeMask' style='top:"+a[1]+"px; left:"+a[0]+"px; width:"+n.offsetWidth+"px; height:"+n.offsetHeight+"px;'></div>",e);l.appendTo(Pe("body",e));r.dragMaskList.push(l)}}}},u={addEditBtn:function(e,t){if(t.editNameFlag||Pe(t,he.id.EDIT,e).length>0){return}if(!Ie.apply(e.edit.showRenameBtn,[e.treeId,t],e.edit.showRenameBtn)){return}var r=Pe(t,he.id.A,e),o="<span class='"+he.className.BUTTON+" edit' id='"+t.tId+he.id.EDIT+"' title='"+Ie.apply(e.edit.renameTitle,[e.treeId,t],e.edit.renameTitle)+"' treeNode"+he.id.EDIT+" style='display:none;'></span>";r.append(o);Pe(t,he.id.EDIT,e).bind("click",function(){if(!Ie.uCanDo(e)||Ie.apply(e.callback.beforeEditName,[e.treeId,t],true)==false)return false;be.editNode(e,t);return false}).show()},addRemoveBtn:function(e,t){if(t.editNameFlag||Pe(t,he.id.REMOVE,e).length>0){return}if(!Ie.apply(e.edit.showRemoveBtn,[e.treeId,t],e.edit.showRemoveBtn)){return}var r=Pe(t,he.id.A,e),o="<span class='"+he.className.BUTTON+" remove' id='"+t.tId+he.id.REMOVE+"' title='"+Ie.apply(e.edit.removeTitle,[e.treeId,t],e.edit.removeTitle)+"' treeNode"+he.id.REMOVE+" style='display:none;'></span>";r.append(o);Pe(t,he.id.REMOVE,e).bind("click",function(){if(!Ie.uCanDo(e)||Ie.apply(e.callback.beforeRemove,[e.treeId,t],true)==false)return false;be.removeNode(e,t);e.treeObj.trigger(he.event.REMOVE,[e.treeId,t]);return false}).bind("mousedown",function(e){return true}).show()},addHoverDom:function(e,t){if(Re.getRoots().showHoverDom){t.isHover=true;if(e.edit.enable){be.addEditBtn(e,t);be.addRemoveBtn(e,t)}Ie.apply(e.view.addHoverDom,[e.treeId,t])}},cancelCurEditNode:function(e,t,r){var o=Re.getRoot(e),d=o.curEditNode;if(d){var i=o.curEditInput,n=t?t:r?Re.nodeName(e,d):i.val();if(Ie.apply(e.callback.beforeRename,[e.treeId,d,n,r],true)===false){return false}Re.nodeName(e,d,n);var a=Pe(d,he.id.A,e);a.removeClass(he.node.CURSELECTED_EDIT);i.unbind();be.setNodeName(e,d);d.editNameFlag=false;o.curEditNode=null;o.curEditInput=null;be.selectNode(e,d,false);e.treeObj.trigger(he.event.RENAME,[e.treeId,d,r])}o.noSelection=true;return true},editNode:function(t,e){var r=Re.getRoot(t);be.editNodeBlur=false;if(Re.isSelectedNode(t,e)&&r.curEditNode==e&&e.editNameFlag){setTimeout(function(){Ie.inputFocus(r.curEditInput)},0);return}e.editNameFlag=true;be.removeTreeDom(t,e);be.cancelCurEditNode(t);be.selectNode(t,e,false);Pe(e,he.id.SPAN,t).html("<input type=text class='rename' id='"+e.tId+he.id.INPUT+"' treeNode"+he.id.INPUT+" >");var o=Pe(e,he.id.INPUT,t);o.attr("value",Re.nodeName(t,e));if(t.edit.editNameSelectAll){Ie.inputSelect(o)}else{Ie.inputFocus(o)}o.bind("blur",function(e){if(!be.editNodeBlur){be.cancelCurEditNode(t)}}).bind("keydown",function(e){if(e.keyCode=="13"){be.editNodeBlur=true;be.cancelCurEditNode(t)}else if(e.keyCode=="27"){be.cancelCurEditNode(t,null,true)}}).bind("click",function(e){return false}).bind("dblclick",function(e){return false});Pe(e,he.id.A,t).addClass(he.node.CURSELECTED_EDIT);r.curEditInput=o;r.noSelection=false;r.curEditNode=e},moveNode:function(e,t,r,o,d,i){var n=Re.getRoot(e);if(t==r)return;if(e.data.keep.leaf&&t&&!Re.nodeIsParent(e,t)&&o==he.move.TYPE_INNER)return;var a=r.parentTId?r.getParentNode():n,l=t===null||t==n;if(l&&t===null)t=n;if(l)o=he.move.TYPE_INNER;var s=t.parentTId?t.getParentNode():n;if(o!=he.move.TYPE_PREV&&o!=he.move.TYPE_NEXT){o=he.move.TYPE_INNER}if(o==he.move.TYPE_INNER){if(l){r.parentTId=null}else{if(!Re.nodeIsParent(e,t)){Re.nodeIsParent(e,t,true);t.open=!!t.open;be.setNodeLineIcos(e,t)}r.parentTId=t.tId}}var f,u;if(l){f=e.treeObj;u=f}else{if(!i&&o==he.move.TYPE_INNER){be.expandCollapseNode(e,t,true,false)}else if(!i){be.expandCollapseNode(e,t.getParentNode(),true,false)}f=Pe(t,e);u=Pe(t,he.id.UL,e);if(!!f.get(0)&&!u.get(0)){var c=[];be.makeUlHtml(e,t,c,"");f.append(c.join(""))}u=Pe(t,he.id.UL,e)}var N=Pe(r,e);if(!N.get(0)){N=be.appendNodes(e,r.level,[r],null,-1,false,true).join("")}else if(!f.get(0)){N.remove()}if(u.get(0)&&o==he.move.TYPE_INNER){u.append(N)}else if(f.get(0)&&o==he.move.TYPE_PREV){f.before(N)}else if(f.get(0)&&o==he.move.TYPE_NEXT){f.after(N)}var v,g,m=-1,p=0,T=null,E=null,I=r.level;var h=Re.nodeChildren(e,a);var b=Re.nodeChildren(e,s);var R=Re.nodeChildren(e,t);if(r.isFirstNode){m=0;if(h.length>1){T=h[1];T.isFirstNode=true}}else if(r.isLastNode){m=h.length-1;T=h[m-1];T.isLastNode=true}else{for(v=0,g=h.length;v<g;v++){if(h[v].tId==r.tId){m=v;break}}}if(m>=0){h.splice(m,1)}if(o!=he.move.TYPE_INNER){for(v=0,g=b.length;v<g;v++){if(b[v].tId==t.tId)p=v}}if(o==he.move.TYPE_INNER){if(!R){R=Re.nodeChildren(e,t,[])}if(R.length>0){E=R[R.length-1];E.isLastNode=false}R.splice(R.length,0,r);r.isLastNode=true;r.isFirstNode=R.length==1}else if(t.isFirstNode&&o==he.move.TYPE_PREV){b.splice(p,0,r);E=t;E.isFirstNode=false;r.parentTId=t.parentTId;r.isFirstNode=true;r.isLastNode=false}else if(t.isLastNode&&o==he.move.TYPE_NEXT){b.splice(p+1,0,r);E=t;E.isLastNode=false;r.parentTId=t.parentTId;r.isFirstNode=false;r.isLastNode=true}else{if(o==he.move.TYPE_PREV){b.splice(p,0,r)}else{b.splice(p+1,0,r)}r.parentTId=t.parentTId;r.isFirstNode=false;r.isLastNode=false}Re.fixPIdKeyValue(e,r);Re.setSonNodeLevel(e,r.getParentNode(),r);be.setNodeLineIcos(e,r);be.repairNodeLevelClass(e,r,I);if(!e.data.keep.parent&&h.length<1){Re.nodeIsParent(e,a,false);a.open=false;var P=Pe(a,he.id.UL,e),w=Pe(a,he.id.SWITCH,e),C=Pe(a,he.id.ICON,e);be.replaceSwitchClass(a,w,he.folder.DOCU);be.replaceIcoClass(a,C,he.folder.DOCU);P.css("display","none")}else if(T){be.setNodeLineIcos(e,T)}if(E){be.setNodeLineIcos(e,E)}if(!!e.check&&e.check.enable&&be.repairChkClass){be.repairChkClass(e,a);be.repairParentChkClassWithSelf(e,a);if(a!=r.parent)be.repairParentChkClassWithSelf(e,r)}if(!i){be.expandCollapseParentNode(e,r.getParentNode(),true,d)}},removeEditBtn:function(e,t){Pe(t,he.id.EDIT,e).unbind().remove()},removeRemoveBtn:function(e,t){Pe(t,he.id.REMOVE,e).unbind().remove()},removeTreeDom:function(e,t){t.isHover=false;be.removeEditBtn(e,t);be.removeRemoveBtn(e,t);Ie.apply(e.view.removeHoverDom,[e.treeId,t])},repairNodeLevelClass:function(e,t,r){if(r===t.level)return;var o=Pe(t,e),d=Pe(t,he.id.A,e),i=Pe(t,he.id.UL,e),n=he.className.LEVEL+r,a=he.className.LEVEL+t.level;o.removeClass(n);o.addClass(a);d.removeClass(n);d.addClass(a);i.removeClass(n);i.addClass(a)},selectNodes:function(e,t){for(var r=0,o=t.length;r<o;r++){be.selectNode(e,t[r],r>0)}}},N={tools:f,view:u,event:s,data:l};Te.extend(true,Te.fn.zTree.consts,Ee);Te.extend(true,Te.fn.zTree._z,N);var v=Te.fn.zTree,Ie=v._z.tools,he=v.consts,be=v._z.view,Re=v._z.data,g=v._z.event,Pe=Ie.$;Re.exSetting(e);Re.addInitBind(o);Re.addInitUnBind(d);Re.addInitCache(r);Re.addInitNode(n);Re.addInitProxy(i);Re.addInitRoot(t);Re.addZTreeTools(a);var m=be.cancelPreSelectedNode;be.cancelPreSelectedNode=function(e,t){var r=Re.getRoot(e).curSelectedList;for(var o=0,d=r.length;o<d;o++){if(!t||t===r[o]){be.removeTreeDom(e,r[o]);if(t)break}}if(m)m.apply(be,arguments)};var p=be.createNodes;be.createNodes=function(e,t,r,o,d){if(p){p.apply(be,arguments)}if(!r)return;if(be.repairParentChkClassWithSelf){be.repairParentChkClassWithSelf(e,o)}};var T=be.makeNodeUrl;be.makeNodeUrl=function(e,t){return e.edit.enable?null:T.apply(be,arguments)};var E=be.removeNode;be.removeNode=function(e,t){var r=Re.getRoot(e);if(r.curEditNode===t)r.curEditNode=null;if(E){E.apply(be,arguments)}};var I=be.selectNode;be.selectNode=function(e,t,r){var o=Re.getRoot(e);if(Re.isSelectedNode(e,t)&&o.curEditNode==t&&t.editNameFlag){return false}if(I)I.apply(be,arguments);be.addHoverDom(e,t);return true};var h=Ie.uCanDo;Ie.uCanDo=function(e,t){var r=Re.getRoot(e);if(t&&(Ie.eqs(t.type,"mouseover")||Ie.eqs(t.type,"mouseout")||Ie.eqs(t.type,"mousedown")||Ie.eqs(t.type,"mouseup"))){return true}if(r.curEditNode){be.editNodeBlur=false;r.curEditInput.focus()}return!r.curEditNode&&(h?h.apply(be,arguments):true)}});